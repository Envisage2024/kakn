<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - KAKN Sites</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
        <style>
            /* Use platform-like white sidebar styling but keep admin markup & JS intact */
            .admin-sidebar {
                width: 260px;
                background: #ffffff;
                box-shadow: 0 1px 3px rgba(0,0,0,0.08);
                display: flex;
                flex-direction: column;
                position: fixed;
                height: 100vh;
                transition: width 0.3s ease;
                z-index: 1000;
                left: 0;
                top: 0;
            }
            .admin-sidebar.active {
                width: 80px;
            }
            /* When sidebar is collapsed, show icons-only and hide logo container */
            .admin-sidebar.active .sidebar-link span,
            .admin-sidebar.active .sidebar-header .logo-text,
            .admin-sidebar.active .sidebar-footer span {
                display: none;
            }
            .admin-sidebar.active .sidebar-header .logo { display: none }
            .admin-sidebar .toggle-btn { margin-left: auto }
            /* When collapsed, move toggle into logo spot */
            .admin-sidebar.active .sidebar-header .toggle-btn {
                position: absolute;
                left: 12px;
                top: 12px;
                margin: 0;
            }
            .admin-sidebar .sidebar-header {
                height: 70px;
                padding: 0 18px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: relative;
            }
            .admin-sidebar .sidebar-header .logo {
                display:flex;align-items:center;gap:12px
            }
            .admin-sidebar .sidebar-header .logo img { width:28px;height:28px;object-fit:contain }
            .admin-sidebar .sidebar-header h2,
            .admin-sidebar .sidebar-header .logo-text { margin:0;font-size:20px;font-weight:700;color:var(--text-dark);white-space:nowrap }
            .sidebar-nav { flex:1;padding:20px 10px;overflow-y:auto }
            /* Keep each sidebar link a uniform height so collapsed icons align with expanded rows */
            .sidebar-link {
                display:flex;align-items:center;gap:12px;padding:0 16px;margin-bottom:8px;border-radius:8px;text-decoration:none;color:var(--text-dark);transition:all 0.3s;position:relative;font-weight:600;min-height:48px;height:48px
            }
            .sidebar-link i { font-size:20px;min-width:20px }
            .sidebar-link:hover { background: var(--lighter-blue, #eff6ff); color: var(--primary-blue, #2563eb) }
            .sidebar-link.active { background: var(--primary-blue, #2563eb); color: #ffffff }
            /* Hide text visually when collapsed but keep the row height via opacity */
            .admin-sidebar.active .sidebar-link span,
            .admin-sidebar.collapsed .sidebar-link span,
            html.sidebar-collapsed .admin-sidebar .sidebar-link span { opacity: 0; pointer-events: none; transition: opacity 0.18s ease; }
            .sidebar-link span { opacity: 1; transition: opacity 0.18s ease; }
            .sidebar-footer { margin-top:auto;padding:18px;border-top:1px solid var(--border-color) }
            .sidebar-footer a { color:var(--text-dark);text-decoration:none;display:flex;align-items:center;gap:10px }
            .sidebar-link .badge { margin-left:auto }

            /* Toggle button (header) styling to match platform look */
            .toggle-btn {
                background: var(--lighter-blue, #eff6ff);
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 8px;
                cursor: pointer;
                color: var(--primary-blue);
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.15s, transform 0.15s;
                padding: 0;
                font-size: 14px;
                box-shadow: 0 4px 10px rgba(2,8,23,0.06);
            }
            /* Strong override for the admin sidebar toggle so it matches platform blue */
            #toggleSidebar { background: var(--lighter-blue) !important; color: var(--primary-blue) !important; }
            #toggleSidebar svg, #toggleSidebar i, #toggleIcon { color: var(--primary-blue) !important; }
            /* Precise sizing and centering for the inline SVG icon */
            #toggleSidebar svg, #toggleSidebar #toggleIcon { width: 16px !important; height: 16px !important; display: block; }
            #toggleSidebar { padding: 0 !important; display: inline-flex; align-items: center; justify-content: center; }
            /* Ensure SVG uses the button color and is perfectly centered */
            #toggleSidebar svg { transform: translateY(0) !important; }
            .toggle-btn:hover { background: var(--light-blue, #dbeafe); transform: translateY(-1px); }

            /* mobile-toggle removed to use single sidebar toggle only */

            /* Keep main content shifted to the right of the sidebar */
            .admin-content { margin-left: 260px; transition: margin-left 0.3s ease; }
            .admin-sidebar.active ~ .admin-content { margin-left: 80px }

            /* Smart collapsing: match platform behavior so header section size doesn't jump */
            .admin-sidebar {
                width: 260px;
                transition: width 0.28s ease;
            }
            .admin-sidebar.collapsed {
                width: 80px;
            }
            .admin-sidebar .sidebar-header {
                height: 70px;
                /* restore original vertical padding so header content doesn't collapse */
                padding: 0 18px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                justify-content: space-between;
                position: relative;
                transition: padding 0.28s ease, justify-content 0.28s ease;
            }
            .admin-sidebar.collapsed .sidebar-header { justify-content: center; padding: 0 12px; }
            .admin-sidebar .logo { display:flex; align-items:center; gap:12px }
            .admin-sidebar.collapsed .logo { display: none; }
            .admin-sidebar.collapsed .site-logo { width: 36px; height: 36px; }
            .admin-sidebar.collapsed .logo-text { display: none; }

            /* keep toggle visible and centered inside the small header when collapsed */
            .admin-sidebar .sidebar-header .toggle-btn { margin-left: auto; transition: all 0.28s ease; }
            .admin-sidebar.collapsed .sidebar-header .toggle-btn {
                position: absolute;
                left: 50%;
                right: auto;
                transform: translate(-50%, -50%);
                top: 50%;
                width: 34px;
                height: 34px;
            }

            /* Tighten section title spacing so content sits closer to header */
            .admin-section h2 { margin: 0 0 10px 0; font-size: 1.05rem; font-weight: 600 }
            .admin-section { margin-top: 0; padding-top: 0 }

            /* Persisted collapsed state applied on <html> to avoid flicker */
            html.sidebar-collapsed .admin-sidebar { width: 80px; }
            html.sidebar-collapsed .admin-sidebar .sidebar-header { justify-content: center; padding: 0; }
            html.sidebar-collapsed .admin-sidebar .logo { display: none; }
            html.sidebar-collapsed .admin-sidebar .site-logo { width: 36px; height: 36px; }
            html.sidebar-collapsed .admin-sidebar .logo-text, html.sidebar-collapsed .admin-sidebar .nav-text, html.sidebar-collapsed .admin-sidebar .badge { display: none; }
            html.sidebar-collapsed .admin-sidebar .main-content { margin-left: var(--sidebar-collapsed-width, 80px); }

            /* Ensure admin header shifts smoothly when sidebar collapses */
            .admin-header { left: 260px; width: calc(100% - 260px); transition: left 0.28s ease, width 0.28s ease; }
            html.sidebar-collapsed .admin-header { left: 80px; width: calc(100% - 80px); }

            @media (max-width:900px) {
                .admin-sidebar { width: 72px }
                .sidebar-link span { display:none }
                .admin-content { margin-left:72px }
            }
            /* ------------------------
               Admin content (platform-like)
               ------------------------ */
            .admin-header {
                background: #ffffff;
                height: 70px;
                padding: 0 20px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 1px 3px rgba(0,0,0,0.08);
                border-radius: 0; /* remove rounded corners */
                /* Fixed to the very top of the viewport and aligned beside the sidebar */
                position: fixed;
                top: 0;
                left: 260px;
                right: 0;
                width: calc(100% - 260px);
                z-index: 200;
                transition: transform 220ms ease, box-shadow 220ms ease;
                will-change: transform;
            }
            /* hide-on-scroll state */
            .admin-header.hide {
                transform: translateY(-110%);
                box-shadow: none;
            }
            /* mobile toggle hidden by default; shown only via media queries */
            .admin-header .mobile-toggle { display: none; }
            .admin-header h1 {
                font-size: 1.25rem;
                color: var(--text-dark);
                margin: 0;
            }
            .admin-user { display:flex;align-items:center;gap:12px;color:var(--text-dark);font-weight:600 }
            .admin-user i { font-size:32px;color:var(--primary-blue) }

            .admin-content {
                margin-left: 260px;
                transition: margin-left 0.3s ease;
                /* top padding set to header height so content sits directly below header */
                padding: 78px 30px 30px 30px; /* header (70px) + 8px gap */
                background: var(--light-gray, #f9fafb);
                min-height: 100vh;
            }
            .admin-sidebar.active ~ .admin-content { margin-left: 80px }
            .admin-sidebar.active ~ .admin-content .admin-header {
                left: 80px;
                width: calc(100% - 80px);
            }

            /* Stats grid (cards) */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
                margin-top: 12px; /* slightly larger gap so cards are separated from header */
            }

            .stat-card {
                background: #ffffff;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                display: flex;
                align-items: center;
                gap: 20px;
                transition: transform 0.25s ease;
            }
            .stat-card:hover { transform: translateY(-4px) }
                .stat-icon { width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px }
                /* Override broader site rules that target .stat-card i and push the
                    icon off-center. Ensure icons inside the colored block are centered. */
                .stat-icon i { margin: 0 !important; line-height: 1 !important; font-size: 1.2rem !important; display: block; }
            .stat-icon.blue { background: var(--primary-blue) }
            .stat-icon.orange { background: var(--accent-orange) }
            .stat-icon.green { background: var(--primary-green) }
            .stat-info h3 { font-size:28px;color:var(--text-dark);margin:0 }
            .stat-info p { color:var(--text-light);margin:0 }

            /* Dashboard content cards */
            .dashboard-content {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 20px;
            }
            .dashboard-card {
                background: #ffffff;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                padding: 20px;
            }
            .dashboard-card h3 { margin:0 0 12px 0;color:var(--text-dark);font-size:1.1rem }
            /* Live Sessions panels: cleaner card, meta rows, and responsive actions */
            .session-panel {
                background: transparent; /* contained inside .form-card */
                border-radius: 8px;
                padding: 0;
                display: block;
            }
            #liveSessionsCard .session-panel > h3 { margin: 0 0 8px 0; font-size:1.05rem; display:block; color:var(--text-dark); }
            .session-card-inner {
                background: #ffffff;
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                display:flex;
                gap:16px;
                align-items:flex-start;
                flex-wrap:wrap;
            }
            .session-thumbnail {
                width:64px; height:64px; border-radius:8px; background:#f3f4f6; display:flex;align-items:center;justify-content:center;color:var(--primary-blue);font-size:20px;flex:0 0 64px
            }
            .session-details { flex:1 1 320px; min-width:180px }
            .session-title { font-weight:700;margin:0 0 6px 0;color:var(--text-dark) }
            .session-topic { color:var(--text-light); margin:0 0 8px 0 }
            .session-meta { display:flex;flex-wrap:wrap;gap:12px;color:var(--text-light);font-size:0.95rem }
            .meta-item { display:flex;gap:8px;align-items:center;color:var(--text-dark) }
            .meta-item i { color:var(--primary-blue); min-width:16px }
            .session-actions { display:flex;gap:8px;align-items:center;justify-content:flex-end;flex:0 0 auto }

            /* Mobile: stack content and place actions below details */
            @media (max-width:900px) {
                .session-card-inner { flex-direction:column; align-items:stretch }
                .session-thumbnail { margin:0 auto 6px auto }
                .session-actions { justify-content:flex-start; width:100%; margin-top:8px }
                #liveSessionsCard { padding:12px }
            }
            .no-data { color: var(--text-light); font-style: italic }

            /* Messages: make the messages section fill the viewport so the
               page itself doesn't scroll â€” only the conversations/message
               panes scroll internally. */
            .admin-section.active#section-messages .messages-container {
                display: flex;
                gap: 18px;
                /* account for header + top padding so container fits fully in viewport */
                height: calc(100vh - 140px);
                max-height: calc(100vh - 140px);
                overflow: hidden;
                align-items: stretch;
                box-sizing: border-box;
                padding: 6px 0 0 0;
            }
            .admin-section.active#section-messages .messages-list {
                flex: 0 0 320px;
                width: 320px;
                overflow: auto;
                padding: 12px;
                box-sizing: border-box;
            }
            .admin-section.active#section-messages .message-thread {
                flex: 1 1 auto;
                display: flex;
                flex-direction: column;
                overflow: visible; /* allow reply form to be visible and not clipped */
                padding: 0 12px 12px 12px;
                box-sizing: border-box;
            }
            .admin-section.active#section-messages #messageThreadHeader { flex: 0 0 auto }
            .admin-section.active#section-messages #messageThreadContent { flex: 1 1 auto; overflow: auto; padding:12px; box-sizing:border-box }
            .admin-section.active#section-messages #messageReplyForm { display:flex; flex: 0 0 auto; padding-top:8px }
            /* Fallback: pin reply form to bottom so it's always visible even if layout changes */
            .admin-section.active#section-messages .message-thread { position: relative }
            .admin-section.active#section-messages #messageReplyForm {
                position: sticky;
                bottom: 12px;
                background: #ffffff;
                padding: 12px;
                box-shadow: 0 -6px 20px rgba(2,8,23,0.06);
                border-radius: 8px;
                z-index: 6;
                gap: 10px;
            }
            .admin-section.active#section-messages #messageThreadContent { padding-bottom: 120px }
            @media (max-width:900px) {
                .admin-section.active#section-messages .messages-container { flex-direction: column; height: calc(100vh - 120px); max-height: calc(100vh - 120px); }
                .admin-section.active#section-messages .messages-list { width: 100%; flex: 0 0 auto; max-height: 220px }
            }

            /* Video tiles (admin) - responsive grid matching platform; centered container (.videos-inner) */
            .videos-inner { max-width: 1100px; margin: 0 auto; width: 100%; }
            .admin-videos-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 22px; align-items: start; }
            .admin-videos-grid .video-card {
                background:#ffffff;
                border-radius:12px;
                overflow:hidden;
                box-shadow:0 6px 20px rgba(2,8,23,0.06);
                cursor:pointer;
                display:flex;
                flex-direction:column;
                min-height: 220px;
            }
            .admin-videos-grid .video-thumbnail {
                height:160px;
                background:#f3f4f6;
                display:flex;
                align-items:center;
                justify-content:center;
                position:relative;
                background-size:cover;
                background-position:center;
            }
            .admin-videos-grid .video-thumbnail .play-icon { font-size:38px;color:rgba(255,255,255,0.92);text-shadow:0 2px 6px rgba(0,0,0,0.25) }
            .admin-videos-grid .video-info { padding:12px; flex:1; display:flex;flex-direction:column;justify-content:space-between }
            .admin-videos-grid .video-info h4 { margin:0 0 6px 0;font-size:1rem;line-height:1.2 }
            .admin-videos-grid .video-meta { font-size:0.85rem;color:var(--text-light);word-break:break-all }
            .video-admin-actions { position:absolute;right:8px;top:8px;display:flex;gap:6px;z-index:2 }
            .video-admin-actions button { background: rgba(0,0,0,0.45); border:none;color:#fff;padding:6px;border-radius:6px;cursor:pointer }
            .video-admin-actions button:hover { background: rgba(0,0,0,0.6) }

            /* Responsive breakpoints: 3 columns desktop, 2 columns tablet, 1 column mobile */
            @media (max-width:1100px) {
                .admin-videos-grid { grid-template-columns: repeat(2, 1fr); }
            }
            @media (max-width:700px) {
                .admin-videos-grid { grid-template-columns: 1fr; }
                .admin-videos-grid .video-thumbnail { height:180px }
            }

            /* Force 3-column layout on wide viewports so videos fill across first */
            @media (min-width:1101px) {
                .admin-videos-grid { grid-template-columns: repeat(3, minmax(280px, 1fr)) !important; }
            }

            /* Forms and lists inside sections should match platform spacing */
            .form-card, .assignments-list, .messages-container, .certifications-grid, .notes-grid, .users-table, .notes-grid {
                background: #ffffff;
                padding: 18px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                margin-bottom: 20px;
            }

            /* Responsive and mobile off-canvas behavior */
            @media (max-width:900px) {
                /* make sidebar narrow by default on small tablets */
                .admin-sidebar { width: 72px }
                .sidebar-link span { display:none }
                .admin-content { margin-left:72px }
                .admin-content .admin-header { left:72px; width: calc(100% - 72px); }

                /* Show mobile toggle earlier for tablets/phones and ensure visibility */
                .admin-header .mobile-toggle { display: inline-flex; margin-right: 12px; z-index: 350 }
                .admin-sidebar .toggle-btn { display: none; }
            }

            /* Off-canvas and mobile-specific rules */
            @media (max-width:768px) {
                /* Use transform for off-canvas so the sidebar animates independently
                   of layout and avoids creating containing blocks that change
                   how fixed children behave. Start hidden by translating fully left. */
                .admin-sidebar {
                    left: 0;
                    top: 0; /* cover full viewport (including header) */
                    transform: translateX(-100%);
                    transition: transform 0.28s ease;
                    z-index: 1230; /* above overlay and header when open */
                    will-change: transform;
                    width: 260px;
                    height: 100vh;
                    position: fixed;
                }
                .admin-sidebar.mobile-open { transform: translateX(0); }

                /* dark overlay when mobile sidebar is open */
                .mobile-overlay {
                    position: fixed;
                    top: 0; /* cover entire viewport */
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.45);
                    z-index: 1220; /* below sidebar but above header */
                }
                /* prevent background scroll while mobile sidebar open */
                body.no-scroll { overflow: hidden; }

                     /* Header occupies full width on mobile and shows a left toggle. Use fixed
                         so it spans the viewport; keep content padded so it doesn't sit under it. */
                     .admin-header { position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; width: 100% !important; padding: 0 14px; z-index: 1210; }
                .admin-header h1 { font-size: 1rem; margin: 0; }
                .admin-header .mobile-toggle { display: inline-flex; margin-right: 12px; }

                    /* Content should not be offset on mobile (sidebar is off-canvas)
                       and center the main column so cards have equal gutters. Add
                       top padding equal to header height so content sits below fixed header. */
                    .admin-layout { display: block; }
                    .admin-content {
                        /* Make the centered column effectively full-width with
                           slightly larger symmetric gutters so content sits
                           evenly from both edges on mobile. */
                        width: 100%;
                        max-width: none;
                        margin-left: auto;
                        margin-right: auto;
                        margin-bottom: 20px;
                        padding-top: 78px; /* header (70px) + small gap */
                        padding-left: 18px;
                        padding-right: 18px;
                        box-sizing: border-box;
                        overflow-x: hidden; /* avoid accidental horizontal overflow */
                    }

                /* Prevent horizontal overflow introduced by fixed/full-width elements */
                html, body { overflow-x: hidden; }

                /* When the sidebar is open on mobile show labels and logo text.
                   Use !important and opacity to override collapsed states. */
                .admin-sidebar.mobile-open .sidebar-link span,
                .admin-sidebar.mobile-open .sidebar-header .logo-text,
                .admin-sidebar.mobile-open .sidebar-footer span {
                    display: inline-block !important;
                    opacity: 1 !important;
                    pointer-events: auto !important;
                }
                .admin-sidebar.mobile-open .logo { display:flex; align-items:center; gap:12px }

                /* Center all major content blocks inside the centered column so
                   every card/list has the same gutters on mobile. Keep width:100%
                   so internal grids become single-column naturally. */
                /* (stats grid selector removed here to avoid selector split issues) */
                /* Remove default blue focus outline for admin header buttons (Achieved etc.)
                   Target the specific Achieved button and outlined buttons with high specificity
                   and keep focus semantics but remove the visual browser ring. */
                #achievedAssignmentsBtn:focus,
                #achievedAssignmentsBtn:focus-visible,
                .admin-section .btn-outline:focus,
                .admin-section .btn-outline:focus-visible,
                .admin-section .btn:focus,
                .admin-section .btn:focus-visible {
                    outline: none !important;
                    box-shadow: none !important;
                }

                /* Manage Assignments: force a 2x2 CSS grid so two cards fit across */
                #manageAssignmentsList {
                    display: grid !important;
                    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
                    gap: 20px !important;
                    align-items: start !important;
                    grid-auto-rows: minmax(120px, auto) !important;
                }

                /* Each tile fills its grid cell */
                #manageAssignmentsList > .assignment-card {
                    width: 100% !important;
                    max-width: 100% !important;
                    box-sizing: border-box !important;
                    display: flex !important;
                    flex-direction: column !important;
                    height: auto !important;
                    border-bottom: none !important;
                    background: #fff;
                    border-radius: 12px;
                    box-shadow: 0 8px 30px rgba(2,8,23,0.06);
                    padding: 12px !important;
                    align-items: flex-start !important;
                }

                /* Compact card styles for 2-across layout */
                #manageAssignmentsList > .assignment-card h4 { font-size: 1rem !important; margin: 0 0 6px 0 !important; }
                #manageAssignmentsList > .assignment-card .assignment-excerpt { font-size: 0.9rem !important; color: var(--text-light) !important; }
                #manageAssignmentsList > .assignment-card .badge { font-size: 0.75rem !important; padding: 4px 8px !important; }



                /* On small screens use single column */
                @media (max-width:900px) {
                    #manageAssignmentsList { grid-template-columns: 1fr !important; }
                }

                /* Extra aggressive fallback: float-based two-column layout to override any runtime styles */
                #manageAssignmentsList { overflow: hidden !important; }
                #manageAssignmentsList > .assignment-card {
                    float: left !important;
                    width: calc(50% - 20px) !important;
                    margin-right: 20px !important;
                    margin-bottom: 20px !important;
                }
                /* clear the last item in each row to avoid uneven wrapping */
                #manageAssignmentsList > .assignment-card:nth-child(2n) { margin-right: 0 !important; }
                @media (max-width:900px) {
                    #manageAssignmentsList > .assignment-card { float:none !important; width:100% !important; margin-right:0 !important; }
                }

                /* Fallback: force inline-block two-column layout to override any JS/inline styles */
                #manageAssignmentsList { text-align: left !important; }
                #manageAssignmentsList > .assignment-card {
                    display: inline-block !important;
                    vertical-align: top !important;
                    width: calc(50% - 10px) !important;
                    margin: 0 10px 20px 0 !important;
                    box-sizing: border-box !important;
                }
                @media (max-width:900px) {
                    #manageAssignmentsList > .assignment-card { width: 100% !important; margin-right: 0 !important; }
                }

                /* Strong ID-specific overrides for Achieved button to remove blue border/ring */
                #achievedAssignmentsBtn {
                    border: 2px solid rgba(0,0,0,0.08) !important;
                    background: #ffffff !important;
                    color: var(--primary-blue) !important;
                    box-shadow: none !important;
                }
                #achievedAssignmentsBtn:hover { background: var(--light-blue, #f1f7ff) !important; }
                #achievedAssignmentsBtn:focus,
                #achievedAssignmentsBtn:focus-visible,
                #achievedAssignmentsBtn:active {
                    outline: none !important;
                    box-shadow: none !important;
                    border-color: rgba(0,0,0,0.08) !important;
                }
                /* Extra aggressive overrides to make sure user-agent rings are disabled */
                button#achievedAssignmentsBtn,
                button#achievedAssignmentsBtn.btn-outline,
                button#achievedAssignmentsBtn.btn-outline:focus,
                button#achievedAssignmentsBtn.btn-outline:focus-visible,
                button#achievedAssignmentsBtn.btn-outline:active {
                    -webkit-appearance: none !important;
                    appearance: none !important;
                    outline: none !important;
                    outline-color: transparent !important;
                    outline-offset: 0 !important;
                    box-shadow: none !important;
                    -webkit-box-shadow: none !important;
                    border: 2px solid rgba(0,0,0,0.08) !important;
                    border-color: rgba(0,0,0,0.08) !important;
                    background: #ffffff !important;
                    color: var(--primary-blue) !important;
                }
                .admin-content > .dashboard-content,
                .admin-content > .dashboard-card,
                .admin-content .form-card,
                .admin-content .assignments-list,
                .admin-content .messages-container,
                .admin-content .certifications-grid,
                .admin-content .notes-grid,
                .admin-content .users-table,
                .admin-content .videos-inner,
                .admin-content .notes-grid,
                .admin-content .dashboard-card {
                    width: 100%;
                    max-width: 100%;
                    padding-left: 0;
                    padding-right: 0;
                    margin-left: auto;
                    margin-right: auto;
                    box-sizing: border-box;
                }

                /* Fix: prevent Recent Activity / Recent Enrollments from overflowing
                   on narrow viewports. Ensure activity items respect the centered
                   column and do not introduce horizontal scroll. */
                #recentActivity, #recentEnrollments {
                    width: 100% !important;
                    max-width: 100% !important;
                    box-sizing: border-box;
                    /* keep symmetric internal gutters so cards sit evenly from edges */
                    padding-left: 12px !important;
                    padding-right: 12px !important;
                    margin-left: 0 !important;
                    margin-right: 0 !important;
                }

                #recentActivity .activity-item,
                #recentEnrollments .activity-item {
                    display: block !important;
                    width: calc(100% - 36px) !important; /* account for side margins */
                    max-width: calc(100% - 36px) !important;
                    box-sizing: border-box;
                    padding-left: 12px !important;
                    padding-right: 12px !important;
                    margin: 8px 18px !important; /* symmetric left/right gutters */
                    overflow: hidden;
                    word-break: break-word;
                }
                /* Allow flex children to shrink to avoid forcing horizontal overflow */
                #recentActivity .activity-item span,
                #recentEnrollments .activity-item span {
                    min-width: 0 !important;
                    flex: 1 1 auto !important;
                    word-break: break-word !important;
                }

                /* Ensure the date/small text doesn't push layout outwards */
                #recentActivity .activity-item small,
                #recentEnrollments .activity-item small {
                    /* give the date a compact fixed width so it won't push content */
                    flex: 0 0 78px !important;
                    max-width: 78px !important;
                    margin-left: 8px !important;
                    margin-right: 6px !important;
                    white-space: nowrap !important;
                    text-align: right;
                    color: var(--text-light);
                    font-size: 0.85rem;
                }

                /* Ensure dashboard cards themselves don't exceed column bounds and have symmetric gutters */
                .dashboard-card { padding-left: 18px !important; padding-right: 18px !important; overflow-x: hidden }

                /* Mobile: keep dashboard cards inset from viewport edges so they
                   visually float with equal left/right gutters. */
                .admin-content .dashboard-card {
                    margin: 10px 18px !important;
                    width: calc(100% - 36px) !important;
                    box-sizing: border-box;
                }
                

                /* Stats grid: show 2 columns on narrow mobile (2x2) and reduce
                   paddings so cards sit closer to the viewport edges. */
                .stats-grid {
                    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
                    gap: 10px !important;
                    margin-bottom: 14px;
                }
                .stat-card {
                    padding: 12px !important;
                    gap: 10px !important;
                }
                .stat-icon { width:44px !important; height:44px !important; font-size:18px !important }
                .stat-info h3 { font-size:18px !important; margin-bottom:6px }
                .stat-info p { font-size:0.82rem !important }

                /* Make video grid single-column on small screens */
                .admin-videos-grid { grid-template-columns: 1fr !important; }
            }
            /* Mobile: fix the live sessions card to viewport and prevent page scroll
               so the card remains visible and centered on small devices. */
            @media (max-width:900px) {
                body.admin-body { overflow: hidden; }
                #liveSessionsCard {
                    position: fixed;
                    left: 12px;
                    right: 12px;
                    top: 78px; /* below fixed header */
                    bottom: 18px;
                    z-index: 1050;
                    overflow: auto;
                    border-radius: 12px;
                    padding: 12px;
                    box-shadow: 0 10px 30px rgba(2,8,23,0.12);
                    background: #ffffff;
                }
                /* Ensure the inner card uses full width inside fixed container */
                .session-card-inner { width: 100%; box-sizing: border-box }

                /* Tighten spacing and reduce sizes so actions sit closer to details */
                .session-card-inner { padding: 10px; gap: 8px }
                .session-thumbnail { width:48px; height:48px; flex:0 0 48px; font-size:18px }
                .session-title { font-size:0.98rem }
                .session-topic { font-size:0.9rem }
                .session-meta { gap:8px; font-size:0.9rem }
                /* Make actions compact and flow right after details (auto width) */
                .session-actions { justify-content:flex-start; width:auto; margin-top:6px; gap:6px }
                /* Smaller button sizing inside the live sessions card on mobile */
                #liveSessionsCard .session-actions .btn-sm { padding:6px 8px; font-size:0.92rem }
            }
        </style>
        <script>
            try {
                // Respect stored collapsed preference only on small viewports.
                // On large screens show expanded sidebar by default.
                const minWidthToExpand = 900;
                const stored = localStorage.getItem('sidebarCollapsed');
                const sidebarEl = document.getElementById('adminSidebar');
                if (stored === 'true' && window.innerWidth <= minWidthToExpand) {
                    document.documentElement.classList.add('sidebar-collapsed');
                    if (sidebarEl) sidebarEl.classList.add('collapsed','active');
                } else {
                    document.documentElement.classList.remove('sidebar-collapsed');
                    if (sidebarEl) sidebarEl.classList.remove('collapsed','active','mobile-open');
                }
            } catch (e) {}
        </script>
</head>
<body class="admin-body">
    <style>
        /* Page background for admin to match platform subtle gray */
        body.admin-body { background: var(--light-gray, #f9fafb); }
    </style>
    <script>
        (function(){
            // Immediate protection: redirect to login if no admin session
            try {
                const raw = localStorage.getItem('currentAdmin');
                if (!raw) { window.location.href = 'index.html'; return; }
                const adm = JSON.parse(raw);
                // expose admin name early for UI
                document.addEventListener('DOMContentLoaded', () => {
                    const nameEl = document.getElementById('adminName');
                    if (nameEl) nameEl.textContent = adm.name || adm.username || 'Admin';
                    const logout = document.getElementById('adminLogout');
                    if (logout) logout.addEventListener('click', (e) => { e.preventDefault(); localStorage.removeItem('currentAdmin'); window.location.href = 'index.html'; });
                });
            } catch (err) {
                localStorage.removeItem('currentAdmin');
                window.location.href = 'index.html';
            }
        })();
    </script>

    <script>
        // Notes search: filter notes by title as user types
        (function(){
            function getCardTitle(card){
                if (!card) return '';
                if (card.dataset && card.dataset.title) return card.dataset.title.trim();
                const h = card.querySelector('h3, h4, h5, .note-title, .title');
                if (h && h.textContent) return h.textContent.trim();
                // fallback: first line of textContent
                return (card.textContent||'').trim().split('\n')[0].trim();
            }

            function applyFilter(q){
                const list = document.getElementById('notesList');
                if (!list) return;
                const items = Array.from(list.children).filter(c => c.nodeType===1 && !c.classList.contains('no-data'));
                let any = false;
                const needle = q.trim().toLowerCase();
                if (!needle){
                    items.forEach(i => { i.style.display = ''; });
                } else {
                    items.forEach(i => {
                        const title = getCardTitle(i).toLowerCase();
                        const visible = title.indexOf(needle) !== -1;
                        i.style.display = visible ? '' : 'none';
                        if (visible) any = true;
                    });
                }

                // show appropriate no-data message
                const noData = list.querySelector('.no-data');
                if (noData) {
                    if (!items.length) {
                        noData.textContent = 'No notes uploaded yet. Click "Upload New Note" to add one.';
                        noData.style.display = '';
                    } else if (!needle) {
                        noData.style.display = 'none';
                    } else {
                        noData.textContent = any ? '' : 'No notes match your search';
                        noData.style.display = any ? 'none' : '';
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function(){
                const input = document.getElementById('noteSearchInput');
                if (!input) return;
                let t = null;
                input.addEventListener('input', function(e){
                    clearTimeout(t);
                    t = setTimeout(() => applyFilter(input.value || ''), 160);
                });
                // run once to set initial state
                applyFilter('');
            });
        })();
    </script>
    

    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="../images/logo.png" alt="KAKN Sites logo" class="site-logo">
                    <span class="logo-text">Admin Panel</span>
                </div>
                <button class="toggle-btn" id="toggleSidebar" aria-label="Toggle sidebar">
                    <!-- Inline SVG for precise centering and consistent sizing -->
                    <svg id="toggleIcon" viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                        <rect x="4" y="6" width="16" height="2" rx="1" fill="currentColor"></rect>
                        <rect x="4" y="11" width="16" height="2" rx="1" fill="currentColor"></rect>
                        <rect x="4" y="16" width="16" height="2" rx="1" fill="currentColor"></rect>
                    </svg>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#assignments" class="sidebar-link" data-section="assignments">
                    <i class="fas fa-tasks"></i>
                    <span>Assignments</span>
                </a>
                <a href="#live-sessions" class="sidebar-link" data-section="live-sessions">
                    <i class="fas fa-video"></i>
                    <span>Live Sessions</span>
                </a>
                <a href="#video-tutorials" class="sidebar-link" data-section="video-tutorials">
                    <i class="fas fa-play-circle"></i>
                    <span>Video Tutorials</span>
                </a>
                <a href="#notes" class="sidebar-link" data-section="notes">
                    <i class="fas fa-book"></i>
                    <span>Course Notes</span>
                </a>
                <a href="#messages" class="sidebar-link" data-section="messages">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                </a>
                <a href="#blogs" class="sidebar-link" data-section="blogs">
                    <i class="fas fa-blog"></i>
                    <span>Blogs</span>
                </a>
                <a href="#certifications" class="sidebar-link" data-section="certifications">
                    <i class="fas fa-certificate"></i>
                    <span>Certifications</span>
                </a>
                <a href="#users" class="sidebar-link" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="#" id="adminLogout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <!-- Mobile Header -->
            <div class="admin-header">
                <button class="toggle-btn mobile-toggle" id="mobileToggle" aria-label="Open navigation">
                    <svg viewBox="0 0 24 24" width="18" height="18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                        <rect x="4" y="6" width="16" height="2" rx="1" fill="currentColor"></rect>
                        <rect x="4" y="11" width="16" height="2" rx="1" fill="currentColor"></rect>
                        <rect x="4" y="16" width="16" height="2" rx="1" fill="currentColor"></rect>
                    </svg>
                </button>
                <h1>Admin Dashboard</h1>
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span id="adminName">Admin</span>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="section-dashboard" class="admin-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Students</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalAssignments">0</h3>
                            <p>Active Assignments</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="unreadMessages">0</h3>
                            <p>New Messages</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCertified">0</h3>
                            <p>Certified Students</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> Recent Activity</h3>
                        <div id="recentActivity">
                            <p class="no-data">No recent activity</p>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-user-graduate"></i> Recent Enrollments</h3>
                        <div id="recentEnrollments">
                            <p class="no-data">No recent enrollments</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Assignments Section -->
            <section id="section-assignments" class="admin-section">
                <h2><i class="fas fa-tasks"></i> Assignment Management</h2>
                
                <button class="btn btn-primary" id="addAssignmentBtn">
                    <i class="fas fa-plus"></i> Add New Assignment
                </button>
                <button class="btn btn-secondary" id="manageAssignmentsBtn" style="margin-left:10px;">
                    <i class="fas fa-edit"></i> Manage Assignments
                </button>
                <button class="btn btn-secondary" id="scoreRespondentsBtn" style="margin-left:10px;">
                    <i class="fas fa-pen"></i> Score Respondents
                </button>
                <button class="btn btn-secondary" id="achievedAssignmentsBtn" style="margin-left:10px;">
                    <i class="fas fa-check-circle"></i> Achieved
                </button>

                <!-- Add Assignment Form -->
                <div id="assignmentForm" class="form-card" style="display: none;">
                    <h3>Create Assignment</h3>
                    <form id="createAssignmentForm">
                        <div class="form-group">
                            <label>Assignment Title</label>
                            <input type="text" id="assignmentTitle" required>
                        </div>

                        <div class="form-group">
                            <label>Module</label>
                            <select id="assignmentModule" required>
                                <option value="1">Module 1: Computer Basics</option>
                                <option value="2">Module 2: Word Processing</option>
                                <option value="3">Module 3: Spreadsheets</option>
                                <option value="4">Module 4: PowerPoint</option>
                                <option value="5">Module 5: Email & Communication</option>
                                <option value="6">Module 6: Digital Classroom Tools</option>
                                <option value="7">Module 7: ICT Safety</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea id="assignmentInstructions" rows="3" required></textarea>
                        </div>

                        <div id="questionsContainer">
                            <h4>Questions</h4>
                            <div class="question-item">
                                <input type="text" placeholder="Question 1" class="question-input" required>
                                <textarea placeholder="Model Answer (optional)" class="answer-input" rows="2"></textarea>
                            </div>
                        </div>

                        <button type="button" class="btn btn-secondary" id="addQuestionBtn">
                            <i class="fas fa-plus"></i> Add Question
                        </button>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Assignment
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancelAssignment">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Assignment Modal -->
                <div id="assignmentModal" class="modal" aria-hidden="true" style="display:none;position:fixed;inset:0;z-index:1250;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,0.45);">
                    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="assignmentModalTitle" style="background:#fff;max-width:720px;width:100%;z-index:1260;border-radius:12px;box-shadow:0 10px 30px rgba(2,8,23,0.2);padding:18px;max-height:90vh;overflow:auto;">
                        <h3 id="assignmentModalTitle">Add Assignment Instructions</h3>
                        <form id="assignmentModalForm">
                            <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
                                <label>Assignment Title</label>
                                <input type="text" id="modalAssignmentTitle" required style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">

                                <label>Module</label>
                                <select id="modalAssignmentModule" required style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">
                                    <option value="1">Module 1: Computer Basics</option>
                                    <option value="2">Module 2: Word Processing</option>
                                    <option value="3">Module 3: Spreadsheets</option>
                                    <option value="4">Module 4: PowerPoint</option>
                                    <option value="5">Module 5: Email & Communication</option>
                                    <option value="6">Module 6: Digital Classroom Tools</option>
                                    <option value="7">Module 7: ICT Safety</option>
                                </select>

                                <label>Instructions & Guidelines</label>
                                <textarea id="modalAssignmentInstructions" rows="4" required style="padding:10px;border:1px solid var(--border-color);border-radius:8px;"></textarea>

                                <label>Due Date</label>
                                <input type="date" id="modalAssignmentDueDate" style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">

                                <label>Google Forms URL</label>
                                <input type="url" id="modalAssignmentFormUrl" placeholder="https://docs.google.com/forms/...'" style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">

                                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                                    <button type="button" class="btn btn-secondary" id="assignmentModalCancel">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="assignmentModalSave">Save</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Scoring Modal -->
                <div id="scoringModal" class="modal" aria-hidden="true" style="display:none;position:fixed;inset:0;z-index:1250;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,0.45);">
                    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="scoringModalTitle" style="background:#fff;max-width:720px;width:100%;z-index:1260;border-radius:12px;box-shadow:0 10px 30px rgba(2,8,23,0.2);padding:18px;max-height:90vh;overflow:auto;">
                        <h3 id="scoringModalTitle">Score Respondent</h3>
                        <form id="scoringModalForm">
                            <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
                                <label>Name</label>
                                <input type="text" id="scoreUserName" disabled style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">

                                <label>Email</label>
                                <input type="email" id="scoreUserEmail" disabled style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">

                                <label>Assignment</label>
                                <select id="scoreAssignmentSelect" required style="padding:10px;border:1px solid var(--border-color);border-radius:8px;"></select>

                                <label>General Score</label>
                                <select id="scoreGeneral" required style="padding:10px;border:1px solid var(--border-color);border-radius:8px;">
                                    <option value="Bad">Bad</option>
                                    <option value="Fair">Fair</option>
                                    <option value="Good">Good</option>
                                    <option value="Very Good">Very Good</option>
                                    <option value="Excellent">Excellent</option>
                                </select>

                                <label>Actual Score</label>
                                <div style="display:flex;gap:8px;align-items:center;">
                                    <input type="number" id="scoreValue" min="0" placeholder="Score" style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:8px;">
                                    <span>/</span>
                                    <input type="number" id="scoreOutOf" min="1" placeholder="Out of" style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:8px;">
                                </div>

                                <label>Comments</label>
                                <textarea id="scoreComments" rows="3" style="padding:10px;border:1px solid var(--border-color);border-radius:8px;"></textarea>

                                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
                                    <button type="button" class="btn btn-secondary" id="scoringModalCancel">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="scoringModalSave">Save Score</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Assignments List -->
                <div id="assignmentsList" class="assignments-list">
                    <p class="no-data">No assignments yet. Click "Add New Assignment" to create one.</p>
                </div>

                <!-- Score Respondents Panel (shows list of users) -->
                <div id="scoreRespondentsPanel" class="form-card" style="display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <h3>Score Respondents</h3>
                    </div>
                    <div id="scoreUsersList">
                        <p class="no-data">Loading users...</p>
                    </div>
                </div>

                <!-- Manage Assignments Panel -->
                <div id="manageAssignmentsPanel" class="form-card" style="display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <h3>Manage Assignments</h3>
                    </div>
                    <div id="manageAssignmentsList">
                        <p class="no-data">Loading assignments...</p>
                    </div>
                    <div id="manageAssignmentContent" class="form-card" style="display:none;margin-top:16px;">
                        <!-- Full assignment details will be shown here when a card is clicked -->
                    </div>
                </div>

                <!-- Achieved Assignments Panel -->
                <div id="achievedAssignmentsPanel" class="form-card" style="display:none;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <h3>Achieved Assignments</h3>
                    </div>
                    <div id="achievedAssignmentsList">
                        <p class="no-data">No achieved assignments yet.</p>
                    </div>
                </div>
            </section>

            <!-- Live Sessions Section -->
            <section id="section-live-sessions" class="admin-section">
                <h2><i class="fas fa-video"></i> Live Sessions</h2>
                <div class="form-card" id="liveSessionsCard" style="max-width:980px;margin:0 auto;">
                    <!-- Controls moved into Current Session panel (Start/Stop) -->
                    <div style="display:flex;gap:12px;align-items:center;justify-content:flex-start;margin-bottom:12px;">
                        <span style="color:var(--text-light)">Manage upcoming or current session below.</span>
                    </div>

                    <div id="liveSessionPanels" style="display:grid;grid-template-columns:1fr;gap:12px;">
                        <div class="session-panel" id="currentSessionPanel">
                            <h3>Upcoming / Current Session</h3>
                            <div class="session-card-inner">
                                <div class="session-thumbnail"><i class="fas fa-video"></i></div>
                                <div class="session-details" id="currentSessionDetails">
                                    <p class="session-title">No active session</p>
                                    <p class="session-topic">Start a session or edit details to add one.</p>
                                    <div class="session-meta">
                                        <div class="meta-item"><i class="fas fa-calendar-alt"></i><span id="currentSessionDate"></span></div>
                                        <div class="meta-item"><i class="fas fa-clock"></i><span id="currentSessionTime"></span></div>
                                        <div class="meta-item"><i class="fas fa-user"></i><span id="currentSessionHost"></span></div>
                                        <div class="meta-item"><i class="fas fa-hashtag"></i><span id="currentSessionRoom"></span></div>
                                    </div>
                                </div>
                                <div class="session-actions">
                                    <button class="btn btn-sm btn-primary" id="startLiveSessionBtn"><i class="fas fa-play"></i> Start</button>
                                    <button class="btn btn-sm btn-secondary" id="stopLiveSessionBtn" style="display:none"><i class="fas fa-stop"></i> Stop</button>
                                    <button class="btn btn-sm btn-outline" id="editCurrentBtn"><i class="fas fa-edit"></i> Edit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Video Tutorials Section -->
            <section id="section-video-tutorials" class="admin-section">
                <h2><i class="fas fa-play-circle"></i> Video Tutorials</h2>
                <div class="form-card">
                    <div class="videos-inner">
                        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;">
                            <div style="display:flex;gap:8px;align-items:center;">
                                <button class="btn btn-primary" id="addVideoBtn"><i class="fas fa-plus"></i> Add Video</button>
                                <button class="btn btn-secondary" id="manageVideosBtn"><i class="fas fa-edit"></i> Manage Videos</button>
                            </div>
                            <div style="flex:1;max-width:720px;margin-left:12px;">
                                <input id="videoSearchInput" type="search" placeholder="Search videos by title" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);">
                            </div>
                        </div>

                        <div id="adminVideosList" class="admin-videos-grid" style="margin-top:16px;">
                            <p class="no-data">No video tutorials yet. Use Add Video to create one.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Messages Section -->
            <section id="section-messages" class="admin-section">
                <h2><i class="fas fa-comments"></i> Student Messages</h2>
                
                <div class="messages-container">
                    <div class="messages-list">
                        <h3>Conversations</h3>
                        <div id="conversationsList">
                            <p class="no-data">No messages yet</p>
                        </div>
                    </div>

                    <div class="message-thread">
                        <div id="messageThreadHeader" class="message-header">
                            <p>Select a conversation to view messages</p>
                        </div>
                        <div id="messageThreadContent" class="message-content">
                        </div>
                        <div id="messageReplyForm" class="message-reply">
                            <textarea id="replyMessage" placeholder="Type your reply..."></textarea>
                            <button class="btn btn-primary" id="sendReplyBtn">
                                <i class="fas fa-paper-plane"></i> Send
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Certifications Section -->
            <section id="section-certifications" class="admin-section">
                <h2><i class="fas fa-certificate"></i> Certification Management</h2>
                
                    <div class="certifications-grid">
                    <div class="cert-card">
                        <h3>Certified Students</h3>
                        <div id="certifiedStudents">
                            <p class="no-data">No certified students yet</p>
                        </div>
                    </div>

                    <div class="cert-card">
                        <h3>Certificate Actions</h3>
                        <div style="display:flex;flex-direction:column;gap:8px;">
                            <p style="margin:0;color:#666">Issue a certificate to a student by providing an access URL.</p>
                            <button class="btn btn-primary" id="certifyStudentBtn" style="align-self:flex-start;margin-top:8px"><i class="fas fa-certificate"></i> Certify Student</button>
                        </div>
                    </div>
                </div>

                <!-- Certify Student Modal -->
                <div id="certifyModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2200;">
                    <div style="position:absolute;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);"></div>
                    <div style="background:white;padding:18px;border-radius:10px;max-width:640px;width:96%;position:relative;z-index:2201;max-height:85vh;overflow:auto;">
                        <button id="certifyModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
                        <h3 style="margin-top:0">Certify Student</h3>
                        <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px">
                            <label>Search Student</label>
                            <input id="certifySearch" type="search" placeholder="Search by name or email" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);">
                            <div id="certifyResults" style="max-height:180px;overflow:auto;border:1px solid var(--border-color);border-radius:8px;padding:8px;background:#fafafa"></div>

                            <div id="certifySelected" style="display:none;padding:8px;border:1px dashed #ddd;border-radius:8px;background:#fff">
                                <strong id="certifySelectedName"></strong>
                                <div id="certifySelectedEmail" style="color:#666;font-size:0.95rem"></div>
                            </div>

                            <label>Access URL</label>
                            <input id="certAccessUrl" type="url" placeholder="https://.../certificate/abc123" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);">

                            <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
                                <button id="cancelCertify" class="btn btn-secondary">Cancel</button>
                                <button id="saveCertify" class="btn btn-primary">Send Certificate</button>
                            </div>
                            <div id="certifyModalMsg" style="color:#d00;font-size:0.9rem;display:none;margin-top:6px"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notes Section -->
            <section id="section-notes" class="admin-section">
                <h2><i class="fas fa-book"></i> Course Notes Management</h2>
                
                <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px;max-width:980px;">
                    <div style="flex:0 0 auto;">
                        <button class="btn btn-primary" id="addNoteBtn">
                            <i class="fas fa-plus"></i> Upload New Note
                        </button>
                    </div>
                    <div style="flex:1;max-width:640px;">
                        <input id="noteSearchInput" type="search" placeholder="Search notes by title" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);">
                    </div>
                </div>

                <!-- Add Note Modal (opens like videos modal) -->
                <div id="noteModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2100;">
                    <div style="position:absolute;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);"></div>
                    <div style="background:white;padding:20px;border-radius:10px;max-width:560px;width:95%;position:relative;z-index:2101;">
                        <button id="noteModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
                        <h3 style="margin-top:0">Upload Course Note</h3>
                        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                            <label>Note URL (PDF link)</label>
                            <input type="url" id="noteUrlInput" placeholder="https://.../note.pdf" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                            <label>Title</label>
                            <input type="text" id="noteTitleInput" placeholder="Note title" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                            <label>Module</label>
                            <select id="noteModuleSelect" style="padding:8px;border:1px solid var(--border-color);border-radius:6px">
                                <option value="1">Module 1: Computer Basics</option>
                                <option value="2">Module 2: Word Processing</option>
                                <option value="3">Module 3: Spreadsheets</option>
                                <option value="4">Module 4: PowerPoint</option>
                                <option value="5">Module 5: Email & Communication</option>
                                <option value="6">Module 6: Digital Classroom Tools</option>
                                <option value="7">Module 7: ICT Safety</option>
                            </select>

                            <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
                                <button id="cancelAddNote" class="btn btn-secondary">Cancel</button>
                                <button id="saveAddNote" class="btn btn-primary">Save Note</button>
                            </div>
                            <div id="noteModalMsg" style="color:#d00;font-size:0.9rem;display:none;margin-top:6px"></div>
                        </div>
                    </div>
                </div>

                <!-- Notes List -->
                <div id="notesList" class="notes-grid">
                    <p class="no-data">No notes uploaded yet. Click "Upload New Note" to add one.</p>
                </div>
            </section>

            <!-- Blogs Section -->
            <section id="section-blogs" class="admin-section">
                <h2><i class="fas fa-blog"></i> Blog Management</h2>

                <button class="btn btn-primary" id="addBlogBtn">
                    <i class="fas fa-plus"></i> Add New Blog
                </button>

                <!-- Blog modal (hidden by default) -->
                <div id="blogModal" class="blog-modal" style="display:none;position:fixed;inset:0;z-index:2000;align-items:center;justify-content:center;">
                    <div class="modal-backdrop" style="position:absolute;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(2px);"></div>
                    <div class="modal-content form-card" style="position:relative;z-index:2001;max-width:900px;width:95%;max-height:90vh;overflow:auto;">
                        <button id="cancelBlog" class="modal-close" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:22px;cursor:pointer;">&times;</button>
                        <h3>Create Blog Post</h3>
                        <form id="createBlogForm">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="blogTitle" required>
                            </div>

                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="blogDate" required>
                            </div>

                            <div class="form-group">
                                <label>Excerpt</label>
                                <textarea id="blogExcerpt" rows="3" required></textarea>
                            </div>

                            <div class="form-group">
                                <label>Thumbnail URL (or upload)</label>
                                <input type="text" id="blogThumbnail" placeholder="Enter image URL or leave blank">
                                <small>For demo: enter image URL or filename from `attached_assets`</small>
                            </div>

                            <div class="form-group">
                                <label>Content</label>
                                <div class="editor-toolbar" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                    <button type="button" data-cmd="bold" class="btn">B</button>
                                    <button type="button" data-cmd="italic" class="btn">I</button>
                                    <button type="button" data-cmd="underline" class="btn">U</button>
                                    <button type="button" data-cmd="insertUnorderedList" class="btn">â€¢ List</button>
                                    <button type="button" data-cmd="createLink" class="btn">Link</button>
                                    <button type="button" data-cmd="insertImage" class="btn">Image</button>
                                    <button type="button" data-cmd="justifyLeft" class="btn">Left</button>
                                    <button type="button" data-cmd="justifyCenter" class="btn">Center</button>
                                    <button type="button" data-cmd="justifyRight" class="btn">Right</button>
                                    <select id="fontSizeSelect" style="padding:6px;border-radius:6px;border:1px solid var(--border-color);">
                                        <option value="">Size</option>
                                        <option value="1">Very Small</option>
                                        <option value="3">Normal</option>
                                        <option value="5">Large</option>
                                    </select>
                                    <input type="color" id="fontColor" title="Text color" style="width:44px;height:36px;border:none;padding:0;margin-left:4px;">
                                </div>
                                <div id="blogContent" contenteditable="true" style="min-height:200px;padding:12px;border:1px solid var(--border-color);border-radius:8px;background:white;overflow:auto;"></div>
                            </div>

                            <div class="form-actions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Blog</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="blogsList" class="notes-grid" style="margin-top:20px;">
                    <p class="no-data">No blog posts yet. Click "Add New Blog" to create one.</p>
                </div>
            </section>

            <!-- Users Section -->
            <section id="section-users" class="admin-section">
                <h2><i class="fas fa-users"></i> User Management</h2>
                
                <div class="form-card" style="display:flex;flex-direction:column;gap:8px;align-items:stretch;margin-bottom:12px">
                    <div style="display:flex;gap:8px;align-items:center">
                        <input id="userSearch" type="search" placeholder="Search users by name, email or phone" style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border-color);">
                        <button id="clearUserSearch" class="btn btn-secondary" style="padding:10px 12px">Clear</button>
                    </div>
                    <div id="userSearchResults" style="position:relative"></div>
                </div>

                <div id="usersList" class="users-table">
                    <p class="no-data">No users registered yet</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Firebase SDK for admin page -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyB5kckado_jqgb1z_oRrLrP90bLvBUZGQs",
          authDomain: "kakn-sites-7c4e9.firebaseapp.com",
          databaseURL: "https://kakn-sites-7c4e9-default-rtdb.firebaseio.com",
          projectId: "kakn-sites-7c4e9",
          storageBucket: "kakn-sites-7c4e9.firebasestorage.app",
          messagingSenderId: "628096383132",
          appId: "1:628096383132:web:26ceb9e11094fe87191559",
          measurementId: "G-VX7S6Y1YN6"
        };
        if (!window.firebase || !firebase.apps || firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
    </script>
    <script src="../js/auth.js"></script>
    <script src="../js/admin.js"></script>

    <script>
        // Sync the top header with the active section title and hide the section H2
        document.addEventListener('DOMContentLoaded', () => {
            const headerTitle = document.querySelector('.admin-header h1');
            const sections = Array.from(document.querySelectorAll('.admin-section'));

            function getSectionTitleText(section) {
                const h2 = section.querySelector('h2');
                if (!h2) return '';
                // strip any icon HTML and return plain text
                return h2.textContent.trim();
            }

            function updateHeaderForActive() {
                const active = document.querySelector('.admin-section.active') || sections[0];
                if (!active) return;
                const titleText = getSectionTitleText(active) || 'Dashboard';
                if (headerTitle) headerTitle.textContent = titleText;

                sections.forEach(s => {
                    const h2 = s.querySelector('h2');
                    if (!h2) return;
                    if (s === active) {
                        h2.style.display = 'none';
                    } else {
                        h2.style.display = 'block';
                    }
                });

                // When messages section is active, prevent page scrolling and
                // allow only the message panes to scroll internally.
                if (active.id === 'section-messages') {
                    document.body.classList.add('messages-fullscreen');
                    document.documentElement.style.overflow = 'hidden';
                    document.body.style.overflow = 'hidden';
                } else {
                    document.body.classList.remove('messages-fullscreen');
                    document.documentElement.style.overflow = '';
                    document.body.style.overflow = '';
                }

                // ensure content sits just below header: scroll a bit to align
                window.setTimeout(() => {
                    const y = Math.max(0, document.querySelector('.admin-header').offsetHeight + 8);
                    window.scrollTo({ top: 0, behavior: 'instant' });
                    document.documentElement.style.scrollPaddingTop = y + 'px';
                }, 0);
            }

            // Hook sidebar nav
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    // allow anchor behavior handled elsewhere, but update active classes here
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    const target = link.dataset.section;
                    if (target) {
                        document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                        const sec = document.getElementById('section-' + target);
                        if (sec) sec.classList.add('active');
                    }
                    updateHeaderForActive();
                });
            });

            // Initial sync
            updateHeaderForActive();
        });
    </script>

    <!-- User detail modal (admin) -->
    <div id="userModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2000;">
        <div style="background:white;padding:20px;border-radius:10px;max-width:820px;width:95%;max-height:90vh;overflow:auto;position:relative;">
            <button id="userModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
            <div id="userModalContent">
                <!-- populated dynamically -->
            </div>
        </div>
    </div>
    
            <!-- Session Edit Modal -->
            <div id="sessionModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2200;">
                <div style="background:white;padding:20px;border-radius:10px;max-width:680px;width:95%;position:relative;">
                    <button id="sessionModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
                    <h3 style="margin-top:0">Edit Live Session</h3>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                        <label>Title</label>
                        <input type="text" id="sessionTitle" placeholder="Session Title" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                        <label>Topic</label>
                        <input type="text" id="sessionTopic" placeholder="Session Topic" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                        <div style="display:flex;gap:8px">
                            <div style="flex:1">
                                <label>Date</label>
                                <input type="date" id="sessionDate" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                            </div>
                            <div style="flex:1">
                                <label>Start Time</label>
                                <input type="time" id="sessionStartTime" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                            </div>
                            <div style="flex:1">
                                <label>End Time</label>
                                <input type="time" id="sessionEndTime" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                            </div>
                        </div>
                        <label>Instructor</label>
                        <input type="text" id="sessionInstructor" placeholder="Instructor name" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                        <label>Meeting URL (Google Meet)</label>
                        <input type="text" id="sessionRoom" placeholder="https://meet.google.com/xxx-xxxx-xxx or meeting code" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                        <small style="color:var(--text-light);display:block;margin-top:6px">Enter a full Google Meet URL or the meeting code (letters, numbers and hyphens). If unsure, click "Start Session" and choose "Create meeting" when prompted.</small>

                        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
                            <button id="cancelSessionEdit" class="btn btn-secondary">Cancel</button>
                            <button id="saveSessionBtn" class="btn btn-primary">Save Session</button>
                        </div>
                        <div id="sessionModalMsg" style="color:#d00;font-size:0.9rem;display:none;margin-top:6px"></div>
                    </div>
                </div>
            </div>

            <!-- Add Video Modal -->
    <div id="videoModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2100;">
        <div style="background:white;padding:20px;border-radius:10px;max-width:560px;width:95%;position:relative;">
            <button id="videoModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
            <h3 style="margin-top:0">Add Video Tutorial</h3>
            <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                <label>Video URL</label>
                <input type="url" id="videoUrlInput" placeholder="https://youtube.com/watch?v=..." style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                <label>Title (optional)</label>
                <input type="text" id="videoTitleInput" placeholder="Optional title" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:6px">
                <label>Description (optional)</label>
                <textarea id="videoDescriptionInput" placeholder="Optional description â€” will be fetched from source if left empty" style="width:100%;min-height:80px;padding:8px;border:1px solid var(--border-color);border-radius:6px"></textarea>
                <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
                    <button id="cancelAddVideo" class="btn btn-secondary">Cancel</button>
                    <button id="saveAddVideo" class="btn btn-primary">Save Video</button>
                </div>
                <div id="videoModalMsg" style="color:#d00;font-size:0.9rem;display:none;margin-top:6px"></div>
            </div>
        </div>
    </div>

    <script>
        // Hide header on scroll down, show on scroll up. Uses rAF for performance.
        (function(){
            const header = document.querySelector('.admin-header');
            const sidebar = document.getElementById('adminSidebar');
            if (!header) return;
            let lastY = window.scrollY || 0;
            let ticking = false;

            function onScroll() {
                const current = window.scrollY || 0;

                // If mobile overlay/sidebar is open, keep header visible
                if (document.body.classList.contains('no-scroll') || (sidebar && sidebar.classList.contains('mobile-open'))) {
                    header.classList.remove('hide');
                    lastY = current;
                    ticking = false;
                    return;
                }

                if (current > lastY && current > 60) {
                    header.classList.add('hide');
                } else {
                    header.classList.remove('hide');
                }
                lastY = Math.max(0, current);
                ticking = false;
            }

            window.addEventListener('scroll', function(){
                if (!ticking) {
                    window.requestAnimationFrame(onScroll);
                    ticking = true;
                }
            }, { passive: true });

            // ensure header visible near top
            window.addEventListener('resize', function(){ if ((window.scrollY||0) < 80) header.classList.remove('hide'); });
        })();
    </script>

</body>
</html>
