<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - KAKN Sites</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
        <style>
            /* Use platform-like white sidebar styling but keep admin markup & JS intact */
            .admin-sidebar {
                width: 260px;
                background: #ffffff;
                box-shadow: 0 1px 3px rgba(0,0,0,0.08);
                display: flex;
                flex-direction: column;
                position: fixed;
                height: 100vh;
                transition: width 0.3s ease;
                z-index: 1000;
                left: 0;
                top: 0;
            }
            .admin-sidebar.active {
                width: 80px;
            }
            .admin-sidebar .sidebar-header {
                padding: 20px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .admin-sidebar .sidebar-header .logo {
                display:flex;align-items:center;gap:12px
            }
            .admin-sidebar .sidebar-header .logo img { width:28px;height:28px;object-fit:contain }
            .admin-sidebar .sidebar-header h2,
            .admin-sidebar .sidebar-header .logo-text { margin:0;font-size:20px;font-weight:700;color:var(--text-dark);white-space:nowrap }
            .sidebar-nav { flex:1;padding:20px 10px;overflow-y:auto }
            .sidebar-link {
                display:flex;align-items:center;gap:12px;padding:12px 16px;margin-bottom:8px;border-radius:8px;text-decoration:none;color:var(--text-dark);transition:all 0.3s;position:relative;font-weight:600
            }
            .sidebar-link i { font-size:20px;min-width:20px }
            .sidebar-link:hover { background: var(--lighter-blue, #eff6ff); color: var(--primary-blue, #2563eb) }
            .sidebar-link.active { background: var(--primary-blue, #2563eb); color: #ffffff }
            .sidebar-footer { margin-top:auto;padding:18px;border-top:1px solid var(--border-color) }
            .sidebar-footer a { color:var(--text-dark);text-decoration:none;display:flex;align-items:center;gap:10px }
            .sidebar-link .badge { margin-left:auto }

            /* Toggle button (header) styling to match platform look */
            .sidebar-toggle {
                background: var(--lighter-blue, #eff6ff);
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 8px;
                cursor: pointer;
                color: var(--primary-blue);
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.3s;
            }
            .sidebar-toggle:hover { background: var(--light-blue, #dbeafe) }

            /* Keep main content shifted to the right of the sidebar */
            .admin-content { margin-left: 260px; transition: margin-left 0.3s ease; }
            .admin-sidebar.active ~ .admin-content { margin-left: 80px }

            @media (max-width:900px) {
                .admin-sidebar { width: 72px }
                .sidebar-link span { display:none }
                .admin-content { margin-left:72px }
            }
            /* ------------------------
               Admin content (platform-like)
               ------------------------ */
            .admin-header {
                background: #ffffff;
                height: 70px;
                padding: 0 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 1px 3px rgba(0,0,0,0.08);
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .admin-header h1 {
                font-size: 1.25rem;
                color: var(--text-dark);
                margin: 0;
            }
            .admin-user { display:flex;align-items:center;gap:12px;color:var(--text-dark);font-weight:600 }
            .admin-user i { font-size:28px;color:var(--primary-blue) }

            .admin-content {
                margin-left: 260px;
                transition: margin-left 0.3s ease;
                padding: 30px;
                background: var(--background);
                min-height: 100vh;
            }
            .admin-sidebar.active ~ .admin-content { margin-left: 80px }

            /* Stats grid (cards) */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: #ffffff;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                display: flex;
                align-items: center;
                gap: 20px;
                transition: transform 0.25s ease;
            }
            .stat-card:hover { transform: translateY(-4px) }
            .stat-icon { width:60px;height:60px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px }
            .stat-icon.blue { background: var(--primary-blue) }
            .stat-icon.orange { background: var(--accent-orange) }
            .stat-icon.green { background: var(--primary-green) }
            .stat-info h3 { font-size:28px;color:var(--text-dark);margin:0 }
            .stat-info p { color:var(--text-light);margin:0 }

            /* Dashboard content cards */
            .dashboard-content {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 20px;
            }
            .dashboard-card {
                background: #ffffff;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                padding: 20px;
            }
            .dashboard-card h3 { margin:0 0 12px 0;color:var(--text-dark);font-size:1.1rem }
            .no-data { color: var(--text-light); font-style: italic }

            /* Forms and lists inside sections should match platform spacing */
            .form-card, .assignments-list, .messages-container, .certifications-grid, .notes-grid, .users-table, .notes-grid {
                background: #ffffff;
                padding: 18px;
                border-radius: 12px;
                box-shadow: 0 6px 20px rgba(2,8,23,0.06);
                margin-bottom: 20px;
            }

            /* Responsive */
            @media (max-width: 900px) {
                .admin-content { margin-left: 72px; padding: 16px }
                .stats-grid { grid-template-columns: 1fr }
            }
            </style>
</head>
<body class="admin-body">
    

    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="../images/logo.png" alt="KAKN Sites logo" class="site-logo">
                    <span class="logo-text">Admin Panel</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#assignments" class="sidebar-link" data-section="assignments">
                    <i class="fas fa-tasks"></i>
                    <span>Assignments</span>
                </a>
                <a href="#messages" class="sidebar-link" data-section="messages">
                    <i class="fas fa-comments"></i>
                    <span>Messages</span>
                </a>
                <a href="#certifications" class="sidebar-link" data-section="certifications">
                    <i class="fas fa-certificate"></i>
                    <span>Certifications</span>
                </a>
                <a href="#notes" class="sidebar-link" data-section="notes">
                    <i class="fas fa-book"></i>
                    <span>Course Notes</span>
                </a>
                <a href="#blogs" class="sidebar-link" data-section="blogs">
                    <i class="fas fa-blog"></i>
                    <span>Blogs</span>
                </a>
                <a href="#users" class="sidebar-link" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="#" id="adminLogout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <!-- Mobile Header -->
            <div class="admin-header">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Admin Dashboard</h1>
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span id="adminName">Admin</span>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="section-dashboard" class="admin-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Students</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalAssignments">0</h3>
                            <p>Active Assignments</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="unreadMessages">0</h3>
                            <p>New Messages</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCertified">0</h3>
                            <p>Certified Students</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> Recent Activity</h3>
                        <div id="recentActivity">
                            <p class="no-data">No recent activity</p>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h3><i class="fas fa-user-graduate"></i> Recent Enrollments</h3>
                        <div id="recentEnrollments">
                            <p class="no-data">No recent enrollments</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Assignments Section -->
            <section id="section-assignments" class="admin-section">
                <h2><i class="fas fa-tasks"></i> Assignment Management</h2>
                
                <button class="btn btn-primary" id="addAssignmentBtn">
                    <i class="fas fa-plus"></i> Add New Assignment
                </button>

                <!-- Add Assignment Form -->
                <div id="assignmentForm" class="form-card" style="display: none;">
                    <h3>Create Assignment</h3>
                    <form id="createAssignmentForm">
                        <div class="form-group">
                            <label>Assignment Title</label>
                            <input type="text" id="assignmentTitle" required>
                        </div>

                        <div class="form-group">
                            <label>Module</label>
                            <select id="assignmentModule" required>
                                <option value="1">Module 1: Computer Basics</option>
                                <option value="2">Module 2: Word Processing</option>
                                <option value="3">Module 3: Spreadsheets</option>
                                <option value="4">Module 4: PowerPoint</option>
                                <option value="5">Module 5: Email & Communication</option>
                                <option value="6">Module 6: Digital Classroom Tools</option>
                                <option value="7">Module 7: ICT Safety</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Instructions</label>
                            <textarea id="assignmentInstructions" rows="3" required></textarea>
                        </div>

                        <div id="questionsContainer">
                            <h4>Questions</h4>
                            <div class="question-item">
                                <input type="text" placeholder="Question 1" class="question-input" required>
                                <textarea placeholder="Model Answer (optional)" class="answer-input" rows="2"></textarea>
                            </div>
                        </div>

                        <button type="button" class="btn btn-secondary" id="addQuestionBtn">
                            <i class="fas fa-plus"></i> Add Question
                        </button>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Assignment
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancelAssignment">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Assignments List -->
                <div id="assignmentsList" class="assignments-list">
                    <p class="no-data">No assignments yet. Click "Add New Assignment" to create one.</p>
                </div>
            </section>

            <!-- Messages Section -->
            <section id="section-messages" class="admin-section">
                <h2><i class="fas fa-comments"></i> Student Messages</h2>
                
                <div class="messages-container">
                    <div class="messages-list">
                        <h3>Conversations</h3>
                        <div id="conversationsList">
                            <p class="no-data">No messages yet</p>
                        </div>
                    </div>

                    <div class="message-thread">
                        <div id="messageThreadHeader" class="message-header">
                            <p>Select a conversation to view messages</p>
                        </div>
                        <div id="messageThreadContent" class="message-content">
                        </div>
                        <div id="messageReplyForm" class="message-reply" style="display: none;">
                            <textarea id="replyMessage" placeholder="Type your reply..."></textarea>
                            <button class="btn btn-primary" id="sendReplyBtn">
                                <i class="fas fa-paper-plane"></i> Send
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Certifications Section -->
            <section id="section-certifications" class="admin-section">
                <h2><i class="fas fa-certificate"></i> Certification Management</h2>
                
                <div class="certifications-grid">
                    <div class="cert-card">
                        <h3>Eligible Students</h3>
                        <div id="eligibleStudents">
                            <p class="no-data">No eligible students yet</p>
                        </div>
                    </div>

                    <div class="cert-card">
                        <h3>Certified Students</h3>
                        <div id="certifiedStudents">
                            <p class="no-data">No certified students yet</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notes Section -->
            <section id="section-notes" class="admin-section">
                <h2><i class="fas fa-book"></i> Course Notes Management</h2>
                
                <button class="btn btn-primary" id="addNoteBtn">
                    <i class="fas fa-plus"></i> Upload New Note
                </button>

                <!-- Add Note Form -->
                <div id="noteForm" class="form-card" style="display: none;">
                    <h3>Upload Course Note</h3>
                    <form id="uploadNoteForm">
                        <div class="form-group">
                            <label>Note Title</label>
                            <input type="text" id="noteTitle" required>
                        </div>

                        <div class="form-group">
                            <label>Module</label>
                            <select id="noteModule" required>
                                <option value="1">Module 1: Computer Basics</option>
                                <option value="2">Module 2: Word Processing</option>
                                <option value="3">Module 3: Spreadsheets</option>
                                <option value="4">Module 4: PowerPoint</option>
                                <option value="5">Module 5: Email & Communication</option>
                                <option value="6">Module 6: Digital Classroom Tools</option>
                                <option value="7">Module 7: ICT Safety</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Content</label>
                            <textarea id="noteContent" rows="6" required placeholder="Enter the note content or paste text here..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>File Upload (optional)</label>
                            <input type="file" id="noteFile" accept=".pdf,.doc,.docx,.txt">
                            <small>For demonstration: File name will be saved, not the actual file</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Upload Note
                            </button>
                            <button type="button" class="btn btn-secondary" id="cancelNote">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Notes List -->
                <div id="notesList" class="notes-grid">
                    <p class="no-data">No notes uploaded yet. Click "Upload New Note" to add one.</p>
                </div>
            </section>

            <!-- Blogs Section -->
            <section id="section-blogs" class="admin-section">
                <h2><i class="fas fa-blog"></i> Blog Management</h2>

                <button class="btn btn-primary" id="addBlogBtn">
                    <i class="fas fa-plus"></i> Add New Blog
                </button>

                <div id="blogForm" class="form-card" style="display: none;">
                    <h3>Create Blog Post</h3>
                    <form id="createBlogForm">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="blogTitle" required>
                        </div>

                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="blogDate" required>
                        </div>

                        <div class="form-group">
                            <label>Excerpt</label>
                            <textarea id="blogExcerpt" rows="3" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>Thumbnail URL (or upload)</label>
                            <input type="text" id="blogThumbnail" placeholder="Enter image URL or leave blank">
                            <small>For demo: enter image URL or filename from `attached_assets`</small>
                        </div>

                        <div class="form-group">
                            <label>Content</label>
                            <div class="editor-toolbar" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
                                <button type="button" data-cmd="bold" class="btn">B</button>
                                <button type="button" data-cmd="italic" class="btn">I</button>
                                <button type="button" data-cmd="underline" class="btn">U</button>
                                <button type="button" data-cmd="insertUnorderedList" class="btn">â€¢ List</button>
                                <button type="button" data-cmd="createLink" class="btn">Link</button>
                                <button type="button" data-cmd="insertImage" class="btn">Image</button>
                                <button type="button" data-cmd="justifyLeft" class="btn">Left</button>
                                <button type="button" data-cmd="justifyCenter" class="btn">Center</button>
                                <button type="button" data-cmd="justifyRight" class="btn">Right</button>
                                <select id="fontSizeSelect" style="padding:6px;border-radius:6px;border:1px solid var(--border-color);">
                                    <option value="">Size</option>
                                    <option value="1">Very Small</option>
                                    <option value="3">Normal</option>
                                    <option value="5">Large</option>
                                </select>
                                <input type="color" id="fontColor" title="Text color" style="width:44px;height:36px;border:none;padding:0;margin-left:4px;">
                            </div>
                            <div id="blogContent" contenteditable="true" style="min-height:200px;padding:12px;border:1px solid var(--border-color);border-radius:8px;background:white;overflow:auto;"></div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Blog</button>
                            <button type="button" class="btn btn-secondary" id="cancelBlog">Cancel</button>
                        </div>
                    </form>
                </div>

                <div id="blogsList" class="notes-grid" style="margin-top:20px;">
                    <p class="no-data">No blog posts yet. Click "Add New Blog" to create one.</p>
                </div>
            </section>

            <!-- Users Section -->
            <section id="section-users" class="admin-section">
                <h2><i class="fas fa-users"></i> User Management</h2>
                
                <div class="form-card" style="display:flex;flex-direction:column;gap:8px;align-items:stretch;margin-bottom:12px">
                    <div style="display:flex;gap:8px;align-items:center">
                        <input id="userSearch" type="search" placeholder="Search users by name, email or phone" style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border-color);">
                        <button id="clearUserSearch" class="btn btn-secondary" style="padding:10px 12px">Clear</button>
                    </div>
                    <div id="userSearchResults" style="position:relative"></div>
                </div>

                <div id="usersList" class="users-table">
                    <p class="no-data">No users registered yet</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Firebase SDK for admin page -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyB5kckado_jqgb1z_oRrLrP90bLvBUZGQs",
          authDomain: "kakn-sites-7c4e9.firebaseapp.com",
          databaseURL: "https://kakn-sites-7c4e9-default-rtdb.firebaseio.com",
          projectId: "kakn-sites-7c4e9",
          storageBucket: "kakn-sites-7c4e9.firebasestorage.app",
          messagingSenderId: "628096383132",
          appId: "1:628096383132:web:26ceb9e11094fe87191559",
          measurementId: "G-VX7S6Y1YN6"
        };
        if (!window.firebase || !firebase.apps || firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
    </script>
    <script src="../js/auth.js"></script>
    <script src="../js/admin.js"></script>

    <!-- User detail modal (admin) -->
    <div id="userModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:2000;">
        <div style="background:white;padding:20px;border-radius:10px;max-width:820px;width:95%;max-height:90vh;overflow:auto;position:relative;">
            <button id="userModalClose" style="position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;">&times;</button>
            <div id="userModalContent">
                <!-- populated dynamically -->
            </div>
        </div>
    </div>
    
</body>
</html>
