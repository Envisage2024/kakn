<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - KAKN Sites</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg1:#0b57a4;--bg2:#1e90ff;--card-bg:rgba(255,255,255,0.06);--glass:rgba(255,255,255,0.08)}
        html,body{height:100%;}
        body{margin:0;font-family:'Poppins',sans-serif;background:radial-gradient(circle at 10% 20%, #0f73b7 0%, rgba(15,115,183,0.75) 20%, rgba(6,36,74,0.85) 60%), linear-gradient(135deg,#0b57a4 0%, #184f7a 100%);color:#fff;display:flex;align-items:center;justify-content:center}
        .login-hero{width:100%;max-width:1200px;height:72vh;min-height:420px;padding:24px;box-sizing:border-box;display:flex;align-items:center;justify-content:center}
        .auth-card{width:100%;height:100%;display:flex;border-radius:16px;overflow:hidden;backdrop-filter:blur(8px);box-shadow:0 12px 40px rgba(2,6,23,0.6);background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));}
        .auth-left{flex:1;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));padding:40px 36px;display:flex;flex-direction:column;align-items:flex-start;justify-content:center;gap:18px}
        .auth-left .logo{width:84px;height:84px;border-radius:12px;overflow:hidden;background:#fff;padding:8px;display:flex;align-items:center;justify-content:center}
        .auth-left h3{margin:0;font-size:28px;line-height:1;color:#eaf6ff}
        .auth-left p{margin:0;color:rgba(230,245,255,0.8)}
        .auth-right{width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:32px;display:flex;flex-direction:column;justify-content:center;gap:14px}
        .auth-right h2{margin:0 0 6px 0;font-size:20px;color:#fff}
        .form-group{display:flex;flex-direction:column;gap:6px}
        label{font-size:13px;color:rgba(255,255,255,0.85)}
        input[type=text],input[type=password]{padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02);color:#fff;outline:none}
        .form-actions{display:flex;gap:10px;width:100%}
        .btn{padding:10px 12px;border-radius:8px;border:none;cursor:pointer}
        .btn-primary{background:linear-gradient(90deg,#0d6efd,#0a58ca);color:#fff}
        .btn-secondary{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff}
        .auth-footer{padding:18px 32px;color:rgba(255,255,255,0.8);font-size:13px}
        @media(max-width:800px){
            .auth-card{flex-direction:column;height:auto}
            .auth-right{width:100%}
            .login-hero{height:auto;padding:18px}
        }
    </style>
</head>
<body>
    
    <div class="login-hero">
        <div class="auth-card">
            <div class="auth-left">
                <div class="logo"><img src="../images/logo.png" alt="KAKN" style="width:100%;height:100%;object-fit:contain"></div>
                <h3>Welcome back</h3>
                <p>Admin portal — manage assignments, users and content from a single place.</p>
            </div>
            <div class="auth-right" style="width:520px;">
                <h2>Admin Sign In</h2>
                <form id="adminLoginForm" class="auth-form">
                    <div class="form-group">
                        <label for="adminUsername"><i class="fas fa-user"></i> Username</label>
                        <input type="text" id="adminUsername" required placeholder="Enter admin username">
                    </div>

                    <div class="form-group">
                        <label for="adminPassword"><i class="fas fa-lock"></i> Password</label>
                        <input type="password" id="adminPassword" required placeholder="Enter password">
                    </div>

                    <div class="form-actions" style="margin-top:6px">
                        <button type="submit" class="btn btn-primary" id="signInBtn" style="flex:1">Sign In</button>
                    </div>
                </form>
                <div style="margin-top:8px;color:rgba(255,255,255,0.7);font-size:13px">Don't share your admin credentials.</div>
                <div class="auth-footer"><a href="../index.html"><i class="fas fa-home"></i> Back to Home</a></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config for project
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyB5kckado_jqgb1z_oRrLrP90bLvBUZGQs",
          authDomain: "kakn-sites-7c4e9.firebaseapp.com",
          databaseURL: "https://kakn-sites-7c4e9-default-rtdb.firebaseio.com",
          projectId: "kakn-sites-7c4e9",
          storageBucket: "kakn-sites-7c4e9.firebasestorage.app",
          messagingSenderId: "628096383132",
          appId: "1:628096383132:web:26ceb9e11094fe87191559",
          measurementId: "G-VX7S6Y1YN6"
        };
        // Initialize Firebase
        if (!window.firebase || !firebase.apps || firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
    </script>

    <script src="../js/auth.js"></script>

    <script>
        // Ensure the dialog fits the viewport and doesn't scroll
        document.documentElement.style.height = '100%';
        document.body.style.minHeight = '100vh';
        document.body.style.display = 'flex';
        document.body.style.alignItems = 'center';
        document.body.style.justifyContent = 'center';
        document.body.style.margin = '0';

        const authCard = document.querySelector('.auth-card');
        if (authCard) {
            authCard.style.maxWidth = '420px';
            authCard.style.width = '92vw';
            authCard.style.boxSizing = 'border-box';
        }

        async function hashString(str) {
            if (window.crypto && crypto.subtle) {
                const enc = new TextEncoder();
                const data = enc.encode(str);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }
            return btoa(str);
        }

        // Save button removed — credential creation is handled elsewhere or via admin tools.

        // Override sign-in to support async login flow using auth.js loginAdmin
        const adminLoginForm = document.getElementById('adminLoginForm');
        if (adminLoginForm) {
            adminLoginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('adminUsername').value.trim();
                const password = document.getElementById('adminPassword').value;
                if (!username || !password) {
                    alert('Enter username and password');
                    return;
                }
                try {
                    const result = await loginAdmin(username, password);
                    if (result.success) {
                        window.location.href = 'admin-dashboard.html';
                    } else {
                        alert(result.message);
                    }
                } catch (err) {
                    alert('Error during login. Check console.');
                    console.error(err);
                }
            });
        }

        // Note: Save functionality removed — signing in uses previously saved credentials.
    </script>
    
</body>
</html>
